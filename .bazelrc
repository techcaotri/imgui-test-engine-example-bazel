# Enable bzlmod
common --enable_bzlmod

# Enable incompatibility flags
common --incompatible_disallow_empty_glob
common --incompatible_enforce_config_setting_visibility

# Build configurations
build --cxxopt=-std=c++17
build --host_cxxopt=-std=c++17

# Warnings
build --cxxopt=-Wall
build --cxxopt=-Wextra
build --cxxopt=-Wpedantic

# Platform-specific OpenGL linking
build:linux --linkopt=-lGL
build:linux --linkopt=-ldl
build:linux --linkopt=-lpthread

build:macos --linkopt=-framework
build:macos --linkopt=OpenGL
build:macos --linkopt=-framework
build:macos --linkopt=Cocoa
build:macos --linkopt=-framework
build:macos --linkopt=IOKit
build:macos --linkopt=-framework
build:macos --linkopt=CoreVideo

build:windows --linkopt=opengl32.lib
build:windows --linkopt=gdi32.lib
build:windows --linkopt=shell32.lib
build:windows --linkopt=user32.lib

# Debug build
build:debug --compilation_mode=dbg
build:debug --copt=-g
build:debug --copt=-O0
build:debug --strip=never

# Release build
build:release --compilation_mode=opt
build:release --copt=-O3
build:release --copt=-DNDEBUG
build:release --copt=-flto
build:release --linkopt=-flto

# Coverage build
build:coverage --compilation_mode=dbg
build:coverage --copt=-g
build:coverage --copt=-O0
build:coverage --collect_code_coverage
build:coverage --combined_report=lcov

build:linux --cxxopt=-fprofile-arcs
build:linux --cxxopt=-ftest-coverage
build:linux --linkopt=-lgcov

# Test configuration
test --test_output=errors
test --test_summary=detailed
test --test_verbose_timeout_warnings
test --test_keep_going
test --build_tests_only

# Coverage test configuration
test:coverage --combined_report=lcov
test:coverage --keep_going
test:coverage --experimental_generate_llvm_lcov

# Coverage configuration
coverage --combined_report=lcov
coverage --instrumentation_filter="//..."

# Coverage build flags to generate .gcno/.gcda files
coverage --copt=--coverage
coverage --linkopt=--coverage
